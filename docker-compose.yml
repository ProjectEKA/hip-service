version: '3'
services:
  hip:
    build: .
    ports:
      - "9052:80"
    depends_on:
      - db
      - rabbitmq
  db:
    image: "postgres:latest"
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=welcome
    ports:
      - "5432:5432"
    volumes:
      - postgresql:/var/lib/postgresql
      - postgresql_data:/var/lib/postgresql/data
  rabbitmq:
    image: "rabbitmq:3"
    ports:
      - "5672:5672"
#  elasticsearch:
#    container_name: hipelasticsearch
#    image: docker.elastic.co/elasticsearch/elasticsearch:7.6.2
#    ports:
#      - 9200:9200
#    volumes:
#      - elasticsearch-data:/usr/share/elasticsearch/data
#    environment:
#      - xpack.monitoring.enabled=true
#      - xpack.watcher.enabled=false
#      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
#      - discovery.type=single-node
#    networks:
#      - elastic

#  kibana:
#    container_name: hipkibana
#    image: docker.elastic.co/kibana/kibana:7.6.2
#    ports:
#      - 5601:5601
#    depends_on:
#      - elasticsearch
#    environment:
#      - ELASTICSEARCH_URL=http://localhost:9200
#    networks:
#      - elastic
  filebeat:
    image: docker.elastic.co/beats/filebeat:7.6.2
    container_name: filebeat
    hostname: filebeat
    networks:
      - backend_default
    volumes:
      - ./filebeat.yml:/usr/share/filebeat/filebeat.yml
      - demo_logs:/applogs

networks:
#  elastic:
#    driver: bridge
  backend_default:
    external: false

volumes:
  postgresql:
  postgresql_data:
  demo_logs:
    driver: local
#  elasticsearch-data: